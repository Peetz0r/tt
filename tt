#!/bin/bash

url="https://teletekst-data.nos.nl/json/$1"
if ! j=$(curl -fsS "$url"); then
  echo "The URL was: $url";
  exit 1;
fi

{
echo '<pre>';
echo "$j" | jq -r .content \
 | sed \
 -e 's:<span class="\([^"]*\)">:\1:g' \
 -e 's:</\?span>:\x1b[m\x1b[97;40m:g' \
 -e 's:<[^s][^>]*>::g' \
 -e 's:doubleHeight ::g' \
 -e 's/bg-black /\x1b[40m/g' \
 -e 's/bg-red /\x1b[101m/g' \
 -e 's/bg-green /\x1b[102m/g' \
 -e 's/bg-yellow /\x1b[103m/g' \
 -e 's/bg-blue /\x1b[104m/g' \
 -e 's/bg-magenta /\x1b[105m/g' \
 -e 's/bg-cyan /\x1b[106m/g' \
 -e 's/bg-white /\x1b[107m/g' \
 -e 's/black /\x1b[90m/g' \
 -e 's/red /\x1b[91m/g' \
 -e 's/green /\x1b[92m/g' \
 -e 's/yellow /\x1b[93m/g' \
 -e 's/blue /\x1b[94m/g' \
 -e 's/magenta /\x1b[95m/g' \
 -e 's/cyan /\x1b[96m/g' \
 -e 's/white /\x1b[97m/g' \
 -e 's/&#xF020;/ /g' \
 -e 's/&#xF021;/ğŸ¬€/g' \
 -e 's/&#xF022;/ğŸ¬/g' \
 -e 's/&#xF023;/ğŸ¬‚/g' \
 -e 's/&#xF024;/ğŸ¬ƒ/g' \
 -e 's/&#xF025;/ğŸ¬„/g' \
 -e 's/&#xF026;/ğŸ¬…/g' \
 -e 's/&#xF027;/ğŸ¬†/g' \
 -e 's/&#xF028;/ğŸ¬‡/g' \
 -e 's/&#xF029;/ğŸ¬ˆ/g' \
 -e 's/&#xF02a;/ğŸ¬‰/g' \
 -e 's/&#xF02b;/ğŸ¬Š/g' \
 -e 's/&#xF02c;/ğŸ¬‹/g' \
 -e 's/&#xF02d;/ğŸ¬Œ/g' \
 -e 's/&#xF02e;/ğŸ¬/g' \
 -e 's/&#xF02f;/ğŸ¬/g' \
 -e 's/&#xF030;/ğŸ¬/g' \
 -e 's/&#xF031;/ğŸ¬/g' \
 -e 's/&#xF034;/ğŸ¬“/g' \
 -e 's/&#xF035;/â–Œ/g' \
 -e 's/&#xF036;/ğŸ¬”/g' \
 -e 's/&#xF037;/ğŸ¬•/g' \
 -e 's/&#xF038;/ğŸ¬–/g' \
 -e 's/&#xF03a;/ğŸ¬˜/g' \
 -e 's/&#xF03b;/ğŸ¬™/g' \
 -e 's/&#xF03c;/ğŸ¬š/g' \
 -e 's/&#xF03d;/ğŸ¬›/g' \
 -e 's/&#xF03e;/ğŸ¬œ/g' \
 -e 's/&#xF03f;/ğŸ¬/g' \
 -e 's/&#xF060;/ğŸ¬/g' \
 -e 's/&#xF062;/ğŸ¬ /g' \
 -e 's/&#xF063;/ğŸ¬¡/g' \
 -e 's/&#xF065;/ğŸ¬˜/g' \
 -e 's/&#xF066;/ğŸ¬¤/g' \
 -e 's/&#xF067;/ğŸ¬¥/g' \
 -e 's/&#xF068;/ğŸ¬¦/g' \
 -e 's/&#xF06a;/â–/g' \
 -e 's/&#xF06b;/ğŸ¬¨/g' \
 -e 's/&#xF06c;/ğŸ¬©/g' \
 -e 's/&#xF06d;/ğŸ¬ª/g' \
 -e 's/&#xF06e;/ğŸ¬«/g' \
 -e 's/&#xF06f;/ğŸ¬¬/g' \
 -e 's/&#xF070;/ğŸ¬­/g' \
 -e 's/&#xF071;/ğŸ¬®/g' \
 -e 's/&#xF072;/ğŸ¬¯/g' \
 -e 's/&#xF073;/ğŸ¬°/g' \
 -e 's/&#xF074;/ğŸ¬±/g' \
 -e 's/&#xF075;/ğŸ¬²/g' \
 -e 's/&#xF076;/ğŸ¬³/g' \
 -e 's/&#xF077;/ğŸ¬´/g' \
 -e 's/&#xF078;/ğŸ¬µ/g' \
 -e 's/&#xF079;/ğŸ¬¶/g' \
 -e 's/&#xF07a;/ğŸ¬·/g' \
 -e 's/&#xF07c;/ğŸ¬¹/g' \
 -e 's/&#xF07d;/ğŸ¬º/g' \
 -e 's/&#xF07e;/ğŸ¬»/g' \
 -e 's/&#xF07f;/â–ˆ/g' \
 -e '/^$/d' \
 -e 's/^\x1b\[..m//g' \
 -e 's/^\x1b\[m\x1b\[97;40m//g' \
 -e 's/^ /\x1b[97;40m/g' \
 -e 's/$/\x1b[m<br>/g';
echo '</pre>';
} \
| tr -d '\n' \
| html2text --unicode-snob \
| sed -z \
 -e 's/&verkeer;/\&verkeer/g' \
 -e 's/ *\n */\n/g' \
 -e 's/\n\n/\n/g' \
 -e 's/^\n//g' \
 -e 's/\n$//g';

echo $j | jq -r '.fastTextLinks[].page' | while read l; do printf '   %s    ' "$l"; done;
echo -e '\n';

printf '%6s    ' '<<' '<  ' '>  ' '>> '
echo;
echo $j | jq -r '.prevPage, .prevSubPage, .nextSubPage, .nextPage' | while read l; do printf '%6s    ' "$l"; done;
echo;
